services:
  infrapass-sidecar:
    image: ghcr.io/tosynthegeek/sui-infrapass/sidecar:latest
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      UPSTREAM_URL: ${UPSTREAM_URL}
      VALIDATOR_API_URL: ${VALIDATOR_API_URL}
      VALIDATOR_API_KEY: ${VALIDATOR_API_KEY}
      PROVIDER_ID: ${PROVIDER_ID}
      REDIS_URL: ${REDIS_URL}
      PORT: 8080
      AUTH_MODE: ${AUTH_MODE:-none}
      AUTH_SECRET: ${AUTH_SECRET:-}
      UPSTREAM_AUTH_TOKEN: ${UPSTREAM_AUTH_TOKEN:-}
      FAIL_OPEN: ${FAIL_OPEN:-false}
      LOG_FORMAT: ${LOG_FORMAT:-json}
      RUST_LOG: ${RUST_LOG:-infrapass_sidecar=info,infrapass=info,tower_http=warn}
